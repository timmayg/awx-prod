---
- name: Fetch the Cert & Private Key from DocWiki Servers
  hosts: docwiki
  gather_facts: true

  tasks:

    - name: 01 - Store file into /etc/ssl/private/cert.key
      ansible.builtin.fetch:
        src: /etc/ssl/private/cert.key
        dest: docwiki-private.key


    - name: 02 - Store file into /etc/ssl/private/cert.pem
      ansible.builtin.fetch:
        src: /etc/ssl/private/cert.pem
        dest: docwiki.pem


    - name: 03 - Write Cert & Key to Vault
      community.hashi_vault.vault_kv2_write:
#        path: "{{ vault_kv_path }}"
#        path: "{{ inventory_hostname }}"
        path: "{{ ansible_fqdn }}"
        url: "{{ vault_url }}"
        auth_method: "{{ vault_auth_method }}"
        token: "{{ vault_token }}"
        engine_mount_point: "{{ vault_mount }}"
        data:
          cert: "the first value"
          private_key: "the second value"


    - name: Timmay HARD STOP this Playbook
      ansible.builtin.meta: end_play

